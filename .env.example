# Example environment configuration for HealthUp
# Copy this file to `.env` and fill in real values

# OpenAI API Key (required for Tier C LLM mapping, v0.9.1+)
OPENAI_API_KEY=your-openai-key-here

DATABASE_URL=postgres://USER:PASSWORD@localhost:5432/DBNAME

# Mapping Applier Configuration (PRD v2.4)
# Automatic analyte mapping is always enabled after lab report upload
MAPPING_AUTO_ACCEPT=0.80              # Confidence threshold for auto-accept
MAPPING_QUEUE_LOWER=0.60              # Lower bound for review queue
BACKFILL_SIMILARITY_THRESHOLD=0.70    # Minimum fuzzy similarity to accept

# SQL Generator Configuration (v0.9.2+)
SQL_GENERATION_ENABLED=true           # Feature flag to enable/disable SQL generation
SQL_GENERATOR_MODEL=gpt-5-mini        # Default model for SQL generation
ALLOW_MODEL_OVERRIDE=false            # Allow per-request model override (dev only)
SQL_SCHEMA_CACHE_TTL_MS=300000        # Schema cache TTL in ms (5min prod, 1min dev)
SCHEMA_WHITELIST=public               # Comma-separated list of allowed schemas
SQLGEN_MAX_JOINS=8                    # Maximum number of JOINs allowed
SQLGEN_MAX_SUBQUERIES=2               # Maximum nested subquery depth
SQLGEN_MAX_AGG_FUNCS=10               # Maximum number of aggregate functions
SQLGEN_RATE_LIMIT_PER_IP=60           # Requests per minute per IP
SQL_VALIDATION_BYPASS=false           # Disable SQL validator (set true only for local debugging)
ADMIN_API_KEY=your-secret-admin-key   # Admin API key for cache busting

# Agentic SQL Generation (v2.0, POC)
AGENTIC_SQL_ENABLED=true              # Enable agentic exploration mode (feature flag)
AGENTIC_MAX_ITERATIONS=5              # Maximum tool-calling iterations per query
AGENTIC_FUZZY_SEARCH_LIMIT=20         # Max results per fuzzy search tool call
AGENTIC_EXPLORATORY_SQL_LIMIT=20      # Max rows for exploratory SQL queries
AGENTIC_SIMILARITY_THRESHOLD=0.3      # pg_trgm similarity threshold (0.0-1.0)
AGENTIC_TIMEOUT_MS=120000             # Total timeout for agentic loop (2 minutes - allows for slow OpenAI responses)
